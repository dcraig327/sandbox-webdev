# Привет, мир!

В этой статье мы создадим простой скрипт и посмотрим, как он работает.
[cut]
## Тег SCRIPT

[smart header="А побыстрее?"]
В том (и только в том!) случае, если читатель нетерпелив и уже разрабатывал на JavaScript или имеет достаточно опыта в другом программировании, он может не читать каждую статью этого раздела, а прыгнуть сразу на главу [](/javascript-specials). Там будет кратко самое основное.

Если же у вас есть достаточно времени и желание начать с азов, то читайте дальше :)
[/smart]

Программы на языке JavaScript можно вставить в любое место HTML при помощи тега `SCRIPT`. Например:

```html
<!--+ run height=100 -->
<!DOCTYPE HTML>
<html>
<head>
  <!-- Тег meta для указания кодировки -->
  <meta charset="utf-8">
</head>
<body>

  <p>Начало документа...</p>

*!*
  <script>
    alert('Привет, Мир!');
  </script>
*/!*

  <p>...Конец документа</p>

</body>
</html>
```

Этот пример использует следующие элементы:
 
<dl>
<dt><code>&lt;script&gt; ... &lt;/script&gt;</code></dt>
<dd>Тег `script` содержит исполняемый код. Предыдущие стандарты HTML требовали обязательного указания атрибута `type`, но сейчас он уже не нужен. Достаточно просто `<script>`.

Браузер, когда видит `<script>`:
<ol>
<li>Начинает отображать страницу, показывает часть документа до `script`</li>
<li>Встретив тег `script`, переключается в JavaScript-режим и не показывает, а исполняет его содержимое.</li>
<li>Закончив выполнение, возвращается обратно в HTML-режим и отображает оставшуюся часть документа.</li>
</ol>

Попробуйте этот пример в действии.
</dd>
<dt>`alert(сообщение)`</dt>
<dd>Отображает окно с сообщением и ждёт, пока посетитель не нажмёт "Ок".</dd>
</dl>

[smart header="Кодировка и тег `META`"]
При попытке сделать такой же файл у себя на диске и запустить, вы можете столкнуться с проблемой -- выводятся "кракозяблы", "квадратики" и "вопросики" вместо русского текста.

Чтобы всё было хорошо, нужно:
<ol>
<li>Убедиться, что в `HEAD` есть строка `<meta charset="utf-8">`. Если вы будете открывать файл с диска, то именно он укажет браузеру кодировку.</li>
<li>Убедиться, что редактор сохранил файл именно в кодировке UTF-8, а не, скажем, в `windows-1251`.</li>
</ol>

Указание кодировки -- часть обычного HTML, я упоминаю об этом "на всякий случай", чтобы не было сюрпризов при запуске примеров локально.
[/smart]


## Современная разметка для SCRIPT

В старых скриптах оформление тега `SCRIPT` было немного сложнее. В устаревших руководствах можно встретить следующие элементы: 

<dl>
 <dt>Атрибут <code>&lt;script <u>type</u>=...&gt;</code></dt>

 <dd>В отличие от HTML5, стандарт HTML 4 требовал обязательного указания этого атрибута. Выглядел он так: `type="text/javascript"`. Если указать другое значение `type`, то скрипт выполнен не будет.

 В современной разработке атрибут `type` не обязателен.
</dd>

 <dt>Атрибут <code>&lt;script <u>language</u>=...&gt;</code></dt>
  <dd>Этот атрибут предназначен для указания языка, на котором написан скрипт. По умолчанию, язык -- JavaScript, так что и этот атрибут ставить не обязательно.</dd>
<dt>Комментарии до и после скриптов</dt>
<dd>В старых руководствах и книгах иногда рекомендуют использовать HTML-комментарии внутри `SCRIPT`, чтобы спрятать Javascript от браузеров, которые не поддерживают его. 

Выглядит это примерно так:

```html
<script type="text/javascript"><!--
    ...
//--></script>
```

Браузер, для которого предназначались такие трюки, очень старый Netscape, давно умер. Поэтому в этих комментариях нет нужды.
</dd>
</dl>

Итак, для вставки скрипта мы просто пишем `<script>`, без дополнительных атрибутов и комментариев.


## Внешние скрипты

Если JavaScript-кода много -- его выносят в отдельный файл, который подключается в HTML:

```html
<script src="/path/to/script.js"></script>
```

Здесь `/path/to/script.js` -- это абсолютный путь к файлу, содержащему скрипт (из корня сайта). 

Браузер сам скачает скрипт и выполнит.

Можно указать и полный URL, например:

```html
<script src="http://code.jquery.com/jquery.js"></script>
```

Вы также можете использовать путь относительно текущей страницы, в частности `src="jquery.js"` обозначает файл из текущей директории.

Чтобы подключить несколько скриптов, используйте несколько тегов:

```html
<script src="/js/script1.js"></script>
<script src="/js/script2.js"></script>
...
```

[smart]
Как правило, в HTML пишут только самые простые скрипты, а сложные выносят в отдельный файл.

Браузер скачает его только первый раз и в дальнейшем, при правильной настройке сервера, будет брать из своего [кеша](http://ru.wikipedia.org/wiki/%D0%9A%D1%8D%D1%88).

Благодаря этому один и тот же большой скрипт, например, меню или библиотека функций, может использоваться на разных страницах без полной перезагрузки с сервера.  

[/smart]


[warn header="Если указан атрибут `src`, то содержимое тега игнорируется."]

В одном теге `SCRIPT` нельзя одновременно подключить внешний скрипт и указать код. 

Вот так не cработает:

```html
<script *!*src*/!*="file.js">
  alert(1); // так как указан src, то внутренняя часть тега игнорируется
</script>
```

Нужно выбрать: либо `SCRIPT` идёт с `src`, либо содержит код. Тег выше следует разбить на два: один -- с `src`, другой -- с кодом, вот так:

```html
<script src="file.js"></script>
<script>
  alert(1); 
</script>
```

[/warn]

## Асинхронные скрипты: defer/async

Обычно тег `<script>` блокирует отображение страницы.

Например, в примере ниже -- пока все кролики не будут посчитаны -- нижний `<p>` не будет показан:

```html
<!--+ run height=100 -->
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
</head>
<body>

  <p>Начинаем считать:</p>

*!*
  <script>
    alert('Первый кролик!');
    alert('Второй кролик!');
    alert('Третий кролик!');
  </script>
*/!*

  <p>Кролики посчитаны!</p>

</body>
</html>
```

Такое поведение называют "синхронным". Как правило, оно вполне нормально, но бывает беда.

Внешние скрипты `<script src="...">` блокируют отображение страницы не только на время выполнения, которое обычно небольшое, но и на время загрузки тоже!

В ряде случаев это совсем неуместно. Например, мы подключаем внешний скрипт, который показывает рекламу. По-хорошему, он не должен никак задерживать отображение страницы сайта. Реклама -- это дополнение к странице, она не должна как-то тормозить сайт и нарушать его функционал.

А представим на минуту, что сервер, с которого загружается внешний скрипт, перегружен и долго не отвечает? Тогда вся страница "подвиснет", пока он не загрузится. 

Вот пример, с подобным скриптом (стоит искусственная задержка загрузки):

```html
<!--+ run height=100 -->
<p>Начало страницы...</p>

<script src="http://js.cx/hello/ads.js?speed=0"></script>

<p>...Важная информация!</p>
```

В примере выше важная информация не покажется, пока не загрузится внешний скрипт. Но действительно ли он так важен, что мы хотим заставить посетителя ждать? Если это реклама или счётчик посещаемости, то вряд ли.

Можно поставить все подобные скрипты в конец страницы -- это уменьшит проблему, но не избавит от неё полностью, поскольку если какой-то один скрипт тормозит или завис, то последующие будут его ждать.

Чтобы это обойти, можно использовать для скриптов атрибуты `async` или `defer`:
<dl>
<dt>Атрибут `async`</dt>
<dd>Поддерживается всеми браузерами, кроме IE9-. Скрипт выполняется полностью асинхронно. То есть, при обнаружении `<script async src="...">` браузер не останавливает обработку страницы, а спокойно работает дальше. Когда скрипт будет загружен -- он выполнится.</dd>
<dt>Атрибут `defer`</dt>
<dd>Поддерживается всеми браузерами, включая самые старые IE. Скрипт выполняется асинхронно, не заставляет ждать страницу, но, в отличие от `async`, браузер гарантирует, что относительный порядок скриптов с `defer` будет сохранён. 

То есть, в таком коде (с `async`) первым сработает тот скрипт, который раньше загрузится:

```html
<script src="1.js" async></script>
<script src="2.js" async></script>
```

А в таком коде (с `defer`) первым сработает всегда `1.js`, а скрипт `2.js`, даже если загрузился раньше, будет его ждать.

```html
<script src="1.js" defer></script>
<script src="2.js" defer></script>
```

Атрибут `defer` используют в тех случаях, когда второй скрипт `2.js` зависит от первого `1.js`, к примеру -- использует что-то, описанное первым скриптом.

</dd>
</dl>

[warn header="Либо `async` либо `defer`"]
Одновременно указывать `async` и `defer` не имеет смысла. 

В этом случае браузер использует только `async`.
[/warn]

[warn header="Атрибуты `async/defer` -- только для внешних скриптов"]
Атрибуты `async/defer` работают только в том случае, если назначены на внешние скрипты, т.е. имеющие `src`. 

При попытке назначить их на обычные скрипты <code>&lt;script&gt;...&lt;/script&gt;</code>, они будут проигнороированы.
[/warn]

Тот же пример с `async`:

```html
<!--+ run height=100 -->
<p>Начало страницы...</p>

<script *!*async*/!* src="http://js.cx/hello/ads.js?speed=0"></script>

<p>...Важная информация!</p>
```

При запуске вы увидите, что вся страница отобразилась тут же, а реклама будет показана позже, когда загрузится скрипт. 

### Разные типы скриптов

На странице могут одновременно быть:
<ul>
<li>обычные скрипты</li>
<li>скрипты с `async`</li>
<li>скрипты с `defer`</li>
</ul>

Если на странице используются разные виды подключения скриптов, то: 
<ul>
<li>Сначала выполнятся обычные скрипты (без `async/defer`), по очереди.</li>
<li>Затем будут выполнены скрипты с `async` и `defer`, при этом относительный порядок между `defer` сохранится, а для `async` -- нет.</li>
</ul>

То есть, такие скрипты:

```html
<script src="1.js"></script>
<script src="2.js" defer></script>
<script src="3.js"></script>
<script src="4.js" defer></script>
```

Выполнятся строго в порядке `1.js` -> `3.js` -> `2.js` -> `4.js`.

А вот такие:

```html
<script src="1.js" async></script>
<script src="2.js" defer></script>
<script src="3.js" async></script>
<script src="4.js" defer></script>
```

Выполнятся в неопределённом порядке, смотря какой загрузится первым. Единственно, атрибут `defer` гарантирует, что `4.js` запустится после `2.js`.

**Большинство современных системы рекламы и счётчиков знают про эти атрибуты и используют их.**

Конечно, система рекламы должна корректно обрабатывать асинхронную загрузку скрипта, но никаких принципиальных проблем с этим нет, в частности, системы от Google и Яндекс используют такой подход по умолчанию.

## Задачи

Очень важно не только читать учебник, но делать что-то самостоятельно.

Решите задачки, чтобы удостовериться, что вы все правильно поняли.

