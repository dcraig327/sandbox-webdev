<!doctype html>
<script>
var db;

var openRequest = indexedDB.open('test_db', 1);

openRequest.onupgradeneeded = function(e) {
  var db = e.target.result;
  console.log('running onupgradeneeded');
  if (!db.objectStoreNames.contains('store')) {
    var storeOS = db.createObjectStore('store',
      {keyPath: 'name'});
  }
};
openRequest.onsuccess = function(e) {
  console.log('running onsuccess');
  db = e.target.result;
  addItem();
};
openRequest.onerror = function(e) {
  console.log('onerror!');
  console.dir(e);
};

function addItem() {
  var transaction = db.transaction(['store'], 'readwrite');
  var store = transaction.objectStore('store');
  var item = {
    name: 'banana',
    price: '$2.99',
    description: 'It is a purple banana!',
    created: new Date().getTime()
  };

  var request = store.add(item);

  request.addEventListener('error', function(e) {
    console.log('REQ error', e);
  });

  request.onsuccess = function(e) {
    console.log('Woot! Did it');
  };

  transaction.onerror = e => console.log("TX ERR", e);
  db.onerror = e => console.log("DB ERR", e);
  window.onerror = e => console.log("WINDOW ERR", e);

}


</script>
